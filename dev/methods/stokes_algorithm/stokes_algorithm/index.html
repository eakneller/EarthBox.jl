<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Stokes-Continuity Algorithm 路 EarthBox.jl</title><meta name="title" content="Stokes-Continuity Algorithm 路 EarthBox.jl"/><meta property="og:title" content="Stokes-Continuity Algorithm 路 EarthBox.jl"/><meta property="twitter:title" content="Stokes-Continuity Algorithm 路 EarthBox.jl"/><meta name="description" content="Documentation for EarthBox.jl."/><meta property="og:description" content="Documentation for EarthBox.jl."/><meta property="twitter:description" content="Documentation for EarthBox.jl."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/custom.css" rel="stylesheet" type="text/css"/><script src="../../../assets/equation-refs.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.png" alt="EarthBox.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">EarthBox.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Introduction</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Installation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../installation/installation/">Installation</a></li><li><a class="tocitem" href="../../../installation/MPI_system/">Using System MPI Binaries</a></li><li><a class="tocitem" href="../../../installation/MUMPS_custom/">Using Custom MUMPS Libraries</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Models</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Model Management with the EarthBox API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../models/model_execution/api_building_and_execution/">Model Building, Execution and Plotting</a></li><li><a class="tocitem" href="../../../models/model_execution/input_file_execution/">Using Input Files</a></li><li><a class="tocitem" href="../../../models/model_execution/background_command_line_execution/">Background Command-line Execution</a></li><li><a class="tocitem" href="../../../models/model_execution/remote_execution/">Batch Remote Execution</a></li><li><a class="tocitem" href="../../../models/model_execution/batch_local_execution/">Batch Local Execution</a></li><li><a class="tocitem" href="../../../models/model_execution/parallel_marker_plotting/">Plotting Marker Swarms in Parallel</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Models</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../models/model_list/">Model List</a></li><li><a class="tocitem" href="../../../models/lithospheric_extension/polyphase_extension_n17/">Polyphase Extension n17</a></li><li><a class="tocitem" href="../../../models/lithospheric_extension/extension_weak_fault/">Extension with Weak Fault</a></li><li><a class="tocitem" href="../../../models/lithospheric_extension/extension_with_softening_b14/">Extension with Softening b14</a></li><li><a class="tocitem" href="../../../models/sdr_formation/sdr_formation/">SDR Formation</a></li><li><a class="tocitem" href="../../../models/vep_extension_downhill_diffusion/vep_extension_downhill_diffusion/">Visco-elasto-plastic Extension with Downhill Diffusion</a></li><li><a class="tocitem" href="../../../models/subduction/slab_retreat/">Slab Retreat</a></li><li><a class="tocitem" href="../../../models/sandbox/sandbox_extension/">Sandbox Extension</a></li><li><a class="tocitem" href="../../../models/sandbox/sandbox_shortening/">Sandbox Shortening</a></li><li><a class="tocitem" href="../../../models/spreading_center/spreading_center/">Spreading Center</a></li><li><a class="tocitem" href="../../../models/hot_box_melting/hot_box_melting/">Hot Box Melting</a></li><li><a class="tocitem" href="../../../models/regional/catl/">Magmatic Crust Formation: Central Atlantic</a></li><li><a class="tocitem" href="../../../models/regional/iberia/">Magma Poor Margin: Iberia</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">Methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../introduction/">Introduction</a></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Governing Equations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../governing_equations/momentum_and_mass/">Conservation of Momentum and Mass</a></li><li><a class="tocitem" href="../../governing_equations/energy/">Conservation of Energy</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Discretization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../discretization/grid_structure/">Staggered Grid Structure</a></li><li><a class="tocitem" href="../../discretization/grid_generation/">Staggered Grid Generation</a></li><li><a class="tocitem" href="../../discretization/marker_distribution/">Marker Distribution</a></li><li><a class="tocitem" href="../../discretization/stokes2D/">Discretization of the 2D Stokes-continuity Equations</a></li><li><a class="tocitem" href="../../discretization/conduction/">Discretization of Heat-conduction Equation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Boundary Conditions</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../discretization/stokes_bcs/">Stokes Boundary Conditions</a></li><li><a class="tocitem" href="../../discretization/heat_bcs/">Heat Boundary Conditions</a></li></ul></li><li><a class="tocitem" href="../../interpolation/marker_grid_interpolation/">Marker-Grid Interpolation</a></li><li class="is-active"><a class="tocitem" href>Stokes-Continuity Algorithm</a><ul class="internal"><li><a class="tocitem" href="#Picard-Loop"><span>Picard Loop</span></a></li><li><a class="tocitem" href="#Visco-plastic-Viscosity-Update-for-Yielding-on-Basic-Grid"><span>Visco-plastic Viscosity Update for Yielding on Basic Grid</span></a></li><li><a class="tocitem" href="#Marker-Visco-plastic-Viscosity"><span>Marker Visco-plastic Viscosity</span></a></li><li><a class="tocitem" href="#Subgrid-stress-Diffusion-Steps"><span>Subgrid-stress Diffusion Steps</span></a></li></ul></li><li><a class="tocitem" href="../../heat_algorithm/heat_algorithm/">Heat Algorithm</a></li><li><a class="tocitem" href="../../sediment_transport/sediment_transport/">Sediment Transport</a></li><li><a class="tocitem" href="../../melt/melt/">Melt</a></li><li><a class="tocitem" href="../../lava_flow/lava_flow/">Lava Flow</a></li><li><a class="tocitem" href="../../viscous_creep/viscous_creep/">Viscous Creep</a></li><li><a class="tocitem" href="../../strain_weakening/strain_weakening/">Strain Weakening</a></li><li><a class="tocitem" href="../../hydrothermal/hydrothermal/">Hydrothermal Circulation</a></li><li><a class="tocitem" href="../../serpentinization/serpentinization/">Serpentinization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Thermo-mechanical Algorithm</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../thermo_mechanical_algorithm/main_steps/">Main Steps</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Pre-solver Steps</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../thermo_mechanical_algorithm/pre_solver_steps/pre_solver_steps/">Pre-solver Steps</a></li><li><a class="tocitem" href="../../../thermo_mechanical_algorithm/pre_solver_steps/sections/rock_property_update/">Rock Property Update Steps</a></li><li><a class="tocitem" href="../../../thermo_mechanical_algorithm/pre_solver_steps/sections/latent_heat_update/">Latent Heat Update Steps</a></li><li><a class="tocitem" href="../../../thermo_mechanical_algorithm/pre_solver_steps/sections/hydrothermal_update/">Hydrothermal Update Steps</a></li><li><a class="tocitem" href="../../../thermo_mechanical_algorithm/pre_solver_steps/sections/marker_failure_prop_update/">Marker Failure Properties Update Steps</a></li><li><a class="tocitem" href="../../../thermo_mechanical_algorithm/pre_solver_steps/sections/marker_viscosity_update/">Marker Creep Viscosity Update Steps</a></li><li><a class="tocitem" href="../../../thermo_mechanical_algorithm/pre_solver_steps/sections/melt_damage_update/">Melt Damage Update Steps</a></li></ul></li><li><a class="tocitem" href="../../../thermo_mechanical_algorithm/stokes_solver_steps/stokes_solver_steps/">Stokes-solver Steps</a></li><li><a class="tocitem" href="../../../thermo_mechanical_algorithm/heat_solver_steps/heat_solver_steps/">Heat-solver Steps</a></li><li><a class="tocitem" href="../../../thermo_mechanical_algorithm/advection_solver_steps/advection_solver_steps/">Advection-solver Steps</a></li><li><input class="collapse-toggle" id="menuitem-5-6" type="checkbox"/><label class="tocitem" for="menuitem-5-6"><span class="docs-label">Post-solver Steps</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../thermo_mechanical_algorithm/post_solver_steps/post_solver_steps/">Post-solver Steps</a></li><li><a class="tocitem" href="../../../thermo_mechanical_algorithm/post_solver_steps/sections/topography/">Topography</a></li><li><a class="tocitem" href="../../../thermo_mechanical_algorithm/post_solver_steps/sections/melt_extraction/">Melt Extraction</a></li><li><a class="tocitem" href="../../../thermo_mechanical_algorithm/post_solver_steps/sections/sediment_transport/">Sediment Transport</a></li><li><a class="tocitem" href="../../../thermo_mechanical_algorithm/post_solver_steps/sections/lava_flow/">Lava Flow</a></li><li><a class="tocitem" href="../../../thermo_mechanical_algorithm/post_solver_steps/sections/marker_transformation/">Marker Transformation</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">EarthBox API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/earthbox_api/">API Overview</a></li><li><a class="tocitem" href="../../../api/earthbox_state/earthbox_state/">EarthBoxState</a></li><li><input class="collapse-toggle" id="menuitem-6-3" type="checkbox"/><label class="tocitem" for="menuitem-6-3"><span class="docs-label">Model Management</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/model_manager/model_manager/">ModelManager</a></li><li><a class="tocitem" href="../../../api/model_manager/xdmf/xdmf_timestep_manager/">XdmfTimeStepsManager</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-4" type="checkbox"/><label class="tocitem" for="menuitem-6-4"><span class="docs-label">Staggered Grid</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/staggered_grid/initialization/">Initialization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-5" type="checkbox"/><label class="tocitem" for="menuitem-6-5"><span class="docs-label">Material Geometry</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/material_geometry/sticky_air_geometry/">StickyAirGeometry</a></li><li><a class="tocitem" href="../../../api/material_geometry/earth_layering/">EarthLayering</a></li><li><a class="tocitem" href="../../../api/material_geometry/litho_strong_zones/">LithoStrongZones</a></li><li><a class="tocitem" href="../../../api/material_geometry/plume/">Plume</a></li><li><a class="tocitem" href="../../../api/material_geometry/crustal_hole/">CrustalHole</a></li><li><a class="tocitem" href="../../../api/material_geometry/rayleigh_taylor/">RayleighTaylor</a></li><li><a class="tocitem" href="../../../api/material_geometry/mobile_wall/">MobileWall</a></li><li><a class="tocitem" href="../../../api/material_geometry/sandbox/">Sandbox</a></li><li><a class="tocitem" href="../../../api/material_geometry/internal_velocity_zone/">InternalVelocityZone</a></li><li><a class="tocitem" href="../../../api/material_geometry/fracture_zone/">FractureZone</a></li><li><a class="tocitem" href="../../../api/material_geometry/weak_fault/">WeakFault</a></li><li><a class="tocitem" href="../../../api/material_geometry/weak_seed/">WeakSeed</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-6" type="checkbox"/><label class="tocitem" for="menuitem-6-6"><span class="docs-label">Boundary Conditions</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/boundary_conditions/boundary_conditions/">Initialization</a></li><li><a class="tocitem" href="../../../api/boundary_conditions/bc_managers/pressure/">Pressure</a></li><li><a class="tocitem" href="../../../api/boundary_conditions/bc_managers/temperature/">Temperature</a></li><li><a class="tocitem" href="../../../api/boundary_conditions/bc_managers/transient_bottom_temperature/">TransientBottomTemperature</a></li><li><a class="tocitem" href="../../../api/boundary_conditions/bc_managers/velocity/">Velocity</a></li><li><a class="tocitem" href="../../../api/boundary_conditions/bc_managers/velocity_from_strain_rate/">VelocityFromStrainRate</a></li><li><a class="tocitem" href="../../../api/boundary_conditions/bc_managers/velocity_stop/">VelocityStop</a></li><li><a class="tocitem" href="../../../api/boundary_conditions/bc_managers/velocity_step/">VelocityStep</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-7" type="checkbox"/><label class="tocitem" for="menuitem-6-7"><span class="docs-label">Marker Initialization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/markers/coordinates/">MarkerCoordinates</a></li><li><a class="tocitem" href="../../../api/markers/temperature/">MarkerTemperature</a></li><li><a class="tocitem" href="../../../api/markers/friction/">MarkerFriction</a></li><li><a class="tocitem" href="../../../api/markers/cohesion/">MarkerCohesion</a></li><li><a class="tocitem" href="../../../api/markers/dilatancy/">MarkerDilatancy</a></li><li><a class="tocitem" href="../../../api/markers/viscous_strain_softening/">MarkerViscousStrainSoftening</a></li><li><a class="tocitem" href="../../../api/markers/preexponential/">MarkerPreexponential</a></li><li><a class="tocitem" href="../../../api/markers/stress_limits/">MarkerStressLimits</a></li><li><a class="tocitem" href="../../../api/markers/boundary_friction/">MarkerBoundaryFriction</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-8" type="checkbox"/><label class="tocitem" for="menuitem-6-8"><span class="docs-label">Marker Materials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/marker_materials/materials/">MarkerMaterials</a></li><li><a class="tocitem" href="../../../api/marker_materials/material_collection_files/">Material Collection Files</a></li><li><a class="tocitem" href="../../../api/marker_materials/material_properties/">Material Properties</a></li><li><a class="tocitem" href="../../../api/marker_materials/material_input/">Material Input</a></li><li><a class="tocitem" href="../../../api/marker_materials/material_types/">Material Types</a></li><li><a class="tocitem" href="../../../api/marker_materials/material_domains/">Material Domains</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-9" type="checkbox"/><label class="tocitem" for="menuitem-6-9"><span class="docs-label">Rock Properties</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/rock_properties/rock_properties/">RockProperties</a></li><li><a class="tocitem" href="../../../api/rock_properties/hydrothermal/hydrothermal/">Hydrothermal Circulation</a></li><li><a class="tocitem" href="../../../api/rock_properties/serpentinization/serpentinization/">Serpentinization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-10" type="checkbox"/><label class="tocitem" for="menuitem-6-10"><span class="docs-label">Stokes Continuity Solver</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/stokes_continuity_solver/stokes_continuity_solver/">StokesContinuitySolver</a></li><li><a class="tocitem" href="../../../api/stokes_continuity_solver/global_plasticity_loop/">GlobalPlasticityLoop</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-11" type="checkbox"/><label class="tocitem" for="menuitem-6-11"><span class="docs-label">Heat Solver</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/heat_solver/heat_solver/">HeatSolver</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-12" type="checkbox"/><label class="tocitem" for="menuitem-6-12"><span class="docs-label">Marker Advection</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/advection/advection/">Advection</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-13" type="checkbox"/><label class="tocitem" for="menuitem-6-13"><span class="docs-label">Interpolation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/interpolation/interpolation/">Interpolation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-14" type="checkbox"/><label class="tocitem" for="menuitem-6-14"><span class="docs-label">Melt Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/melt_model/melt_model/">MeltModel</a></li><li><a class="tocitem" href="../../../api/melt_model/melt_extraction/">MeltExtraction</a></li><li><a class="tocitem" href="../../../api/melt_model/melt_extrusion/">MeltExtrusion</a></li><li><a class="tocitem" href="../../../api/melt_model/melt_damage/">MeltDamage</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-15" type="checkbox"/><label class="tocitem" for="menuitem-6-15"><span class="docs-label">Surface Processes</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/surface_processes/topography/">Topography</a></li><li><a class="tocitem" href="../../../api/surface_processes/sealevel/">Sealevel</a></li><li><a class="tocitem" href="../../../api/surface_processes/relative_base_level/">RelativeBaseLevel</a></li><li><a class="tocitem" href="../../../api/surface_processes/sediment_transport/">SedimentTransport</a></li><li><a class="tocitem" href="../../../api/surface_processes/salt/">SaltDeposition</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-16" type="checkbox"/><label class="tocitem" for="menuitem-6-16"><span class="docs-label">Time Step Execution and Initialization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/run_time_steps/run_time_steps/">Execution</a></li><li><a class="tocitem" href="../../../api/run_time_steps/time_Step_initialization/">Initialization</a></li><li><a class="tocitem" href="../../../api/run_time_steps/examples/">Examples</a></li></ul></li><li><a class="tocitem" href="../../../api/command_line_args/command_line_args/">Command-line Arguments</a></li><li><a class="tocitem" href="../../../api/case_management/case_management/">Case Management</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Material Library</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../material_library/material_library/">MaterialLibrary</a></li><li><a class="tocitem" href="../../../material_library/collections/lithospheric_deformation_eb1/">Collection: Lithospheric Deformation eb1</a></li><li><a class="tocitem" href="../../../material_library/collections/benchmarks/">Collection: Benchmarks</a></li><li><a class="tocitem" href="../../../material_library/collections/benchmarks_sfs/">Collection: Benchmarks SFS</a></li><li><a class="tocitem" href="../../../material_library/collections/sandbox/">Collection: Sandbox</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Plot Tools</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../plot_tools/cl_plotter/">Command-line Plotter</a></li><li><a class="tocitem" href="../../../plot_tools/scalar_grid_plots/">Scalar Grid Plots</a></li><li><a class="tocitem" href="../../../plot_tools/vector_plots/">Velocity Vector Plots</a></li><li><a class="tocitem" href="../../../plot_tools/marker_plots/">Marker Swarm Plots</a></li><li><a class="tocitem" href="../../../plot_tools/yield_strength_plots/">Yield Strength Plots</a></li><li><a class="tocitem" href="../../../plot_tools/stokes_convergence_plots/">Stokes Convergence Plots</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox"/><label class="tocitem" for="menuitem-9"><span class="docs-label">Data Types</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../data_types/data_types/">Data Types</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-10" type="checkbox"/><label class="tocitem" for="menuitem-10"><span class="docs-label">Model Data</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../model_data/model_data/">ModelData</a></li><li><input class="collapse-toggle" id="menuitem-10-2" type="checkbox"/><label class="tocitem" for="menuitem-10-2"><span class="docs-label">Collections</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../model_data/collections/benchmarks/">Benchmarks</a></li><li><a class="tocitem" href="../../../model_data/collections/bcs/">BoundaryConditions</a></li><li><a class="tocitem" href="../../../model_data/collections/carbonate/">Carbonate</a></li><li><a class="tocitem" href="../../../model_data/collections/conversion/">Conversion</a></li><li><a class="tocitem" href="../../../model_data/collections/geometry/">Geometry</a></li><li><a class="tocitem" href="../../../model_data/collections/gravity/">Gravity</a></li><li><a class="tocitem" href="../../../model_data/collections/grids/">Grids</a></li><li><a class="tocitem" href="../../../model_data/collections/heat_equation/">HeatEquation</a></li><li><a class="tocitem" href="../../../model_data/collections/interpolation/">Interpolation</a></li><li><a class="tocitem" href="../../../model_data/collections/markers/">Markers</a></li><li><a class="tocitem" href="../../../model_data/collections/materials/">Materials</a></li><li><a class="tocitem" href="../../../model_data/collections/melting/">Melting</a></li><li><a class="tocitem" href="../../../model_data/collections/stokes_continuity/">StokesContinuity</a></li><li><a class="tocitem" href="../../../model_data/collections/timestep/">Timestep</a></li><li><a class="tocitem" href="../../../model_data/collections/topography/">Topography</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-11" type="checkbox"/><label class="tocitem" for="menuitem-11"><span class="docs-label">Units</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../units/units/">Units</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-12" type="checkbox"/><label class="tocitem" for="menuitem-12"><span class="docs-label">Benchmarks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../benchmarks/benchmarks/">Benchmarks</a></li><li><a class="tocitem" href="../../../benchmarks/single_execution/">Single Execution</a></li><li><a class="tocitem" href="../../../benchmarks/batch_execution/">Batch Execution</a></li><li><input class="collapse-toggle" id="menuitem-12-4" type="checkbox"/><label class="tocitem" for="menuitem-12-4"><span class="docs-label">Results</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../benchmarks/models/couette_flow_viscous_heating/">Couette Flow with Viscous Heating</a></li><li><a class="tocitem" href="../../../benchmarks/models/channel_flow_variable_conductivity/">Channel Flow Variable Conductivity</a></li><li><a class="tocitem" href="../../../benchmarks/models/channel_flow_non_steady_temperature/">Channel Flow Non Steady Temperature</a></li><li><a class="tocitem" href="../../../benchmarks/models/channel_flow_non_newtonian/">Channel Flow Non Newtonian</a></li><li><a class="tocitem" href="../../../benchmarks/models/solid_body_rotation/">Solid Body Rotation</a></li><li><a class="tocitem" href="../../../benchmarks/models/rayleigh_taylor_instability/">Rayleigh Taylor Instability</a></li><li><a class="tocitem" href="../../../benchmarks/models/elastic_slab/">Elastic Slab</a></li><li><a class="tocitem" href="../../../benchmarks/models/viscoelastic_stress_buildup/">Viscoelastic Stress Buildup</a></li><li><a class="tocitem" href="../../../benchmarks/models/box_convection_isoviscous_1a/">Box Convection Isoviscous 1a</a></li><li><a class="tocitem" href="../../../benchmarks/models/plasticity_benchmark_kaus10/">Plasticity Benchmark Kaus10</a></li><li><a class="tocitem" href="../../../benchmarks/models/seafloor_spreading/">Seafloor Spreading</a></li><li><a class="tocitem" href="../../../benchmarks/models/flexure_triangular_hole/">Flexure Triangular Hole</a></li><li><a class="tocitem" href="../../../benchmarks/models/viscoelastic_extension/">Viscoelastic Extension</a></li><li><a class="tocitem" href="../../../benchmarks/models/viscoelastic_contraction/">Viscoelastic Contraction</a></li><li><a class="tocitem" href="../../../benchmarks/models/simple_sedimentation/">Simple Sedimentation</a></li></ul></li></ul></li><li><a class="tocitem" href="../../../bibliography/bibliography/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Methods</a></li><li class="is-active"><a href>Stokes-Continuity Algorithm</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Stokes-Continuity Algorithm</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Algorithm-for-Solving-the-Visco-elasto-plastic-Stokes-Continuity-Equations"><a class="docs-heading-anchor" href="#Algorithm-for-Solving-the-Visco-elasto-plastic-Stokes-Continuity-Equations">Algorithm for Solving the Visco-elasto-plastic Stokes-Continuity Equations</a><a id="Algorithm-for-Solving-the-Visco-elasto-plastic-Stokes-Continuity-Equations-1"></a><a class="docs-heading-anchor-permalink" href="#Algorithm-for-Solving-the-Visco-elasto-plastic-Stokes-Continuity-Equations" title="Permalink"></a></h1><p>The frictional-plastic failure model used in this work introduces a strong non-linearity where the visco-plastic viscosity <span>${\eta_{vp,m}}$</span> is dependent on deviatoric stress and  deviatoric stress is in turn dependent on the visco-plastic viscosity as described in  equations <a href="../../governing_equations/momentum_and_mass/#eq:visco-plastic-viscosity">eq:visco-plastic-viscosity</a> and <a href="../../governing_equations/momentum_and_mass/#eq:second-invariant-elastic-stress">eq:second-invariant-elastic-stress</a>.  EarthBox uses a node-based Picard iteration method to iteratively solve the non-linear Stokes-continuity  equations on the staggered grid. </p><p>The deviatoric stress tensor is updated on markers that are advected with the velocity field. Updating  the deviatoric stress tensor on markers requires accounting for three components of stress change:</p><ol><li>deviatoric grid stress changes from equation <a href="#eq:visco-elasto-plastic-stress-changes">Eq.</a> obtained on the Eulerian staggered grid by solving the non-linear Stokes-continuity equation  with visco-elasto-plastic stress forecast</li><li>deviatoric stress changes occurring at a subgrid scale on individual markers</li><li>deviatoric stress changes associated with the rotation of markers during advection</li></ol><p>The following steps are used to solve equations <a href="../../governing_equations/momentum_and_mass/#eq:x-stokes">eq:x-stokes</a>, <a href="../../governing_equations/momentum_and_mass/#eq:y-stokes">eq:y-stokes</a>,  and <a href="../../governing_equations/momentum_and_mass/#eq:continuity">eq:continuity</a> using the visco-elasto-plastic constitutive law described in equations  <a href="../../governing_equations/momentum_and_mass/#eq:xx-stress">eq:xx-stress</a> and <a href="../../governing_equations/momentum_and_mass/#eq:xy-stress">eq:xy-stress</a>, and update the deviatoric stress tensor on  markers for the three components of stress change described above.</p><p><strong>For each time step <span>$t$</span> do:</strong></p><p>[1] Set model time step <span>$\Delta t$</span> equal to visco-elastic time step <span>$\Delta t_{ve}$</span>.</p><p>[2] Update marker failure properties including cohesion <span>$\sigma_{c,m}$</span> and friction angle <span>$\theta_m$</span> including the effects of randomized initial friction angle <span>$\theta_m^o$</span>, strain  weakening and melt damage.</p><p>[3] Update non-linear creep viscosity <span>$\eta_{creep,m}$</span> including the effects of temperature, pressure, stress.</p><p>[4] Initialize visco-plastic viscosity <span>$\eta_{vp,m}$</span> with <span>$\eta_{creep,m}$</span> and update for the effects of partial melt.</p><p>[5] Interpolate Stokes-continuity parameters from markers to staggered grids using equation  <a href="../../interpolation/marker_grid_interpolation/#eq:bilinear_interp2grid">eq:bilinear_interp2grid</a>:</p><p class="math-container">\[\begin{split}
    \text{Density (inclusive): } \rho_m \rightarrow \rho_{(i,j)_b} \\
    \text{Cohesion (exclusive): } C_m \rightarrow C_{(i,j)_b} \\
    \text{Friction angle (exclusive): } \theta_m \rightarrow \theta_{(i,j)_b} \\
    \text{Creep viscosity (exclusive): } \eta_{creep,m} \rightarrow \eta_{creep{(i,j)_b}} \\
    \text{Visco-plastic Shear Viscosity (exclusive): } \eta_{vp,m} \rightarrow \eta_{vp(i,j)_b} \\
    \text{Visco-plastic Normal Viscosity (exclusive): } \eta_{vp,m} \rightarrow \eta_{vp(i,j)_p} \\
    \text{Shear modulus on basic nodes (exclusive): } \mu_m \rightarrow \mu_{(i,j)_b} \\
    \text{Shear modulus on pressure nodes (inclusive): } \mu_m \rightarrow \mu_{(i,j)_p} \\
    \text{Deviatoric shear stress (exclusive): } \sigma_{xy,m}&#39; \rightarrow \sigma_{xy(i,j)_{b1}}&#39; \\
    \text{Deviatoric normal stress (inclusive): } \sigma_{xx,m}&#39; \rightarrow \sigma_{xx(i,j)_{p1}}&#39; \\
\end{split}\]</p><p>[6] Calculate updated solutions for x-component of velocity <span>$v_{x(i,j)_{vx}}$</span>, y-component of velocity  <span>$v_{y(i,j)_{vy}}$</span> and pressure <span>$P_{(i,j)_p}$</span> using a node-based Picard iteration loop  (<a href="#Picard-Loop">Picard Loop</a>) with iterative updates to visco-plastic shear viscosity on the basic grid <span>$\eta_{vp(i,j)_b}$</span> that take into account plastic yielding and visco-plastic normal viscosity on pressure  grid <span>$\eta_{vp(i,j)_p}$</span> calculated using a harmonic average of updated shear visco-plastic viscosity  on basic nodes.</p><p>[7] Update model time step <span>$\Delta t$</span> ensuring that displacement is less than a user specified fraction of the staggered grid spacing based on current velocity solutions <span>$v_{x(i,j)vx}$</span> and  <span>$v_{y(i,j)vy}$</span> and grid spacings <span>$\Delta x_{(i,j)vx}$</span> and <span>$\Delta y_{(i,j)vy}$</span>.</p><p>[8] Calculate marker visco-plastic viscosity <span>$\eta_{vp,m}$</span> by interpolating visco-plastic viscosity  from basic grid <span>$\eta_{vp(i,j)_b}$</span> and taking plastic yielding into account (<a href="#Marker-Visco-plastic-Viscosity">Marker Visco-plastic Viscosity</a>).</p><p>[9] Forecast deviatoric stresses <span>$\sigma_{xx(i,j)_{p2}}&#39;$</span> and <span>$\sigma_{xy(i,j)_{b2}}&#39;$</span> using  equation <a href="#eq:deviatoric-stress-forecast">Eq.</a> with updated deviatoric strain rates  <span>$\dot{\epsilon}_{xx(i,j)_p}&#39;$</span> and <span>$\dot{\epsilon}_{xy(i,j)_b}&#39;$</span>, updated visco-plastic  viscosity <span>$\eta_{vp(i,j)_p}$</span> and <span>$\eta_{vp(i,j)_b}$</span> and updated model time step <span>$\Delta t$</span>.</p><p>[10] Update grid deviatoric stress changes using the following equations:</p><h6 id="eq:visco-elasto-plastic-stress-changes"><a class="docs-heading-anchor" href="#eq:visco-elasto-plastic-stress-changes">eq:visco-elasto-plastic-stress-changes</a><a id="eq:visco-elasto-plastic-stress-changes-1"></a><a class="docs-heading-anchor-permalink" href="#eq:visco-elasto-plastic-stress-changes" title="Permalink"></a></h6><p class="math-container">\[\begin{split}
\Delta \sigma_{xx(i,j)_p}&#39; = \sigma_{xx(i,j)_{p2}}&#39; - \sigma_{xx(i,j)_{p1}}&#39; \\
\Delta \sigma_{xy(i,j)_b}&#39; = \sigma_{xy(i,j)_{b2}}&#39; - \sigma_{xy(i,j)_{b1}}&#39;
\end{split}\]</p><p>[11] Update marker deviatoric stress components <span>$\sigma_{xx,m}&#39;$</span> and <span>$\sigma_{xx,m}&#39;$</span> by applying subgrid-stress diffusion steps (<a href="#Subgrid-stress-Diffusion-Steps">Subgrid-stress Diffusion Steps</a>).</p><p>[12] Advect markers and calculate marker angular velocity <span>$\omega_m$</span> using the 4-th order  Runge-Kutta method and angular velocity on the basic grid <span>$\omega_{(i,j)_b}$</span> given by:</p><h6 id="eq:angular-velocity"><a class="docs-heading-anchor" href="#eq:angular-velocity">eq:angular-velocity</a><a id="eq:angular-velocity-1"></a><a class="docs-heading-anchor-permalink" href="#eq:angular-velocity" title="Permalink"></a></h6><p class="math-container">\[\omega_{(i,j)_b} =
    0.5\left(
        \frac{(v_{y(i,j+1)vy} - v_{y(i,j)vy})}{ \Delta x_{vy(j)} }
        - \frac{(v_{x(i+1,j)vx} - v_{x(i,j)vx})}{\Delta y_{vx(i)}}
        \right)\]</p><p>[13] Rotate deviatoric stress components on markers using the following equations:</p><h6 id="eq:stress-rotation"><a class="docs-heading-anchor" href="#eq:stress-rotation">eq:stress-rotation</a><a id="eq:stress-rotation-1"></a><a class="docs-heading-anchor-permalink" href="#eq:stress-rotation" title="Permalink"></a></h6><p class="math-container">\[\begin{split}
\sigma_{xx,m}&#39; = 
    \sigma_{xx,m}&#39;^o\left(\cos(\omega_m \Delta t)^{2} - \sin(\omega_m \Delta t)^{2}\right)
    - \sigma_{xy,m}&#39;^o \sin(2\omega_m \Delta t
    ) \text{, }\\
\sigma_{xy,m}&#39; = 
    \sigma_{xx,m}&#39;^o \sin(2\omega_m \Delta t) + \sigma_{xy,m}&#39;^o \cos(2\omega_m \Delta t)
\end{split}\]</p><p>where <span>$\sigma_{xx,m}&#39;^o$</span> and <span>$\sigma_{xy,m}&#39;^o$</span> are the deviatoric marker stress components  before advection.</p><p>[14] Advance model time <span>$t$</span> by <span>$\Delta t$</span>.</p><h2 id="Picard-Loop"><a class="docs-heading-anchor" href="#Picard-Loop">Picard Loop</a><a id="Picard-Loop-1"></a><a class="docs-heading-anchor-permalink" href="#Picard-Loop" title="Permalink"></a></h2><p><strong>While Picard criterion <span>$R_{L2}$</span> <span>$&gt;$</span> <span>$Tolerance$</span> and <span>$N_{iterations} &lt; N_{max}$</span> do:</strong></p><p>[1] Calculate the visco-plastic viscosity on pressure grid <span>$\eta_{vp(i,j)_p}$</span> as a harmonic     average of the visco-plastic viscosity <span>$\eta_{vp(i,j)_b}$</span> on surrounding basic nodes:</p><h6 id="eq:harmonic-viscosity-average"><a class="docs-heading-anchor" href="#eq:harmonic-viscosity-average">eq:harmonic-viscosity-average</a><a id="eq:harmonic-viscosity-average-1"></a><a class="docs-heading-anchor-permalink" href="#eq:harmonic-viscosity-average" title="Permalink"></a></h6><p class="math-container">\[\eta_{vp(i,j)_p} = \frac{4}{
    1/\eta_{vp(i,j)_b} + 1/\eta_{vp(i-1,j)_b} 
    + 1/\eta_{vp(i,j-1)_b} + 1/\eta_{vp(i-1,j-1)_b}
    }\]</p><p>[2] Obtain new solution vector <span>$S^{new}$</span> and updated solutions for x-component of velocity      <span>$v_{x(i,j)_{vx}}$</span>, y-component of velocity <span>$v_{y(i,j)_{vy}}$</span> and pressure <span>$P_{(i,j)_p}$</span>      by solving equations <a href="../../governing_equations/momentum_and_mass/#eq:x-stokes">eq:x-stokes</a>, <a href="../../governing_equations/momentum_and_mass/#eq:y-stokes">eq:y-stokes</a>, and <a href="../../governing_equations/momentum_and_mass/#eq:continuity">eq:continuity</a>      using current <span>$\eta_{vp(i,j)_b}$</span> and <span>$\eta_{vp(i,j)_p}$</span>.</p><p>[3] Update the convergence <span>$R_{L2}$</span> criterion defined as:</p><h6 id="eq:picard_criterion"><a class="docs-heading-anchor" href="#eq:picard_criterion">eq:picard_criterion</a><a id="eq:picard_criterion-1"></a><a class="docs-heading-anchor-permalink" href="#eq:picard_criterion" title="Permalink"></a></h6><p class="math-container">\[R_{L2} = \frac{
    \sqrt{\displaystyle\sum_{i} (S_{v_{xy},i}^{new} - S_{v_{xy},i}^{old})^2}
    }{
    \sqrt{ \displaystyle\sum_{i} (S_{v_{xy},i}^{new})^2}
    }\]</p><p>where <span>$S_{v_{xy}}^{old}$</span> is the old velocity solution vector and <span>$S_{v_{xy}}^{new}$</span> is the  new velocity solution vector.</p><p>[4] Calculate deviatoric strain rate components <span>$\dot{\epsilon}_{xx(i,j)_p}&#39;$</span> and  <span>$\dot{\epsilon}_{xy(i,j)_b}&#39;$</span> using updated velocity solutions <span>$v_{x(i,j)vx}$</span> and  <span>$v_{y(i,j)vy}$</span> and the following equation:</p><h6 id="eq:deviatoric-strain-rate"><a class="docs-heading-anchor" href="#eq:deviatoric-strain-rate">eq:deviatoric-strain-rate</a><a id="eq:deviatoric-strain-rate-1"></a><a class="docs-heading-anchor-permalink" href="#eq:deviatoric-strain-rate" title="Permalink"></a></h6><p class="math-container">\[\begin{split}
\dot{\epsilon&#39;}_{xx(i,j)_p} = \frac{1}{2} \left( 
    \frac{
        v_{x(i+1,j+1)vx} - v_{x(i+1,j)vx}
        }{\Delta x_{j_b}} 
    - \frac{
        v_{y(i+1,j+1)vy} - v_{y(i,j+1)vy}
        }{\Delta y_{i_b}} 
\right) \quad \text{and} \\
\dot{\epsilon&#39;}_{xy(i,j)_b} = \frac{1}{2} \left( 
    \frac{
        v_{x(i+1,j)vx} - v_{x(i,j)vx}
        }{\Delta y_{i_p}} 
    + \frac{
        v_{y(i,j+1)vx} - v_{y(i,j)vx}
        }{\Delta x_{j_p}}
\right) \text{, }
\end{split}\]</p><p>[5] Forecast deviatoric stresses <span>$\sigma_{xx(i,j)_{p2}}&#39;$</span> and <span>$\sigma_{xy(i,j)_{b2}}&#39;$</span> using  updated deviatoric strain rates <span>$\dot{\epsilon}_{xx(i,j)_p}&#39;$</span> and <span>$\dot{\epsilon}_{xy(i,j)_b}&#39;$</span>,  updated visco-plastic viscosity <span>$\eta_{vp(i,j)_p}$</span> and <span>$\eta_{vp(i,j)_b}$</span> with the  following equations:</p><h6 id="eq:deviatoric-stress-forecast"><a class="docs-heading-anchor" href="#eq:deviatoric-stress-forecast">eq:deviatoric-stress-forecast</a><a id="eq:deviatoric-stress-forecast-1"></a><a class="docs-heading-anchor-permalink" href="#eq:deviatoric-stress-forecast" title="Permalink"></a></h6><p class="math-container">\[\begin{split}
    \sigma_{xx(i,j)_{p2}}&#39; = 
        2 \eta_{vp(i,j)_p} \dot{\epsilon}_{xx(i,j)_p}&#39;
            \frac{ \mu_{(i,j)_b} \Delta t }{ \mu_{(i,j)_b} \Delta t + \eta_{vp(i,j)_p} } 
        + \sigma_{xx(i,j)_{p1}}&#39; 
            \frac{ \eta_{vp(i,j)_p} }{ \mu_{(i,j)_b} \Delta t + \eta_{vp(i,j)_p} } 
                \quad \text{and} \\
    \sigma_{xy(i,j)_{b2}}&#39; =
        2 \eta_{vp(i,j)_b} \dot{\epsilon}_{xy(i,j)_b}&#39;
            \frac{ \mu_{(i,j)_b} \Delta t }{ \mu_{(i,j)_b} \Delta t + \eta_{vp(i,j)_b} }
        + \sigma_{xy(i,j)_{b1}}&#39;
            \frac{ \eta_{vp(i,j)_b} }{ \mu_{(i,j)_b} \Delta t + \eta_{vp(i,j)_b} }
\end{split}\]</p><p>[6] Update visco-plastic viscosity on basic grid <span>$\eta_{vp(i,j)_b}$</span> for plastic yielding, and update yield state <span>$\chi_{(i,j)_b}$</span>  (<a href="#Visco-plastic-Viscosity-Update-for-Yielding-on-Basic-Grid">Visco-plastic Viscosity Update for Yielding on Basic Grid</a>).</p><h2 id="Visco-plastic-Viscosity-Update-for-Yielding-on-Basic-Grid"><a class="docs-heading-anchor" href="#Visco-plastic-Viscosity-Update-for-Yielding-on-Basic-Grid">Visco-plastic Viscosity Update for Yielding on Basic Grid</a><a id="Visco-plastic-Viscosity-Update-for-Yielding-on-Basic-Grid-1"></a><a class="docs-heading-anchor-permalink" href="#Visco-plastic-Viscosity-Update-for-Yielding-on-Basic-Grid" title="Permalink"></a></h2><p><strong>For Each Basic Node <span>$(i,j)$</span> Do:</strong></p><p>[1] Calculate the second invariant of deviatoric stress <span>$\sigma_{{II}(i,j)_b}&#39;$</span> using updated  deviatoric stresses <span>$\sigma_{xx(i,j)_{b2}}&#39;$</span> and <span>$\sigma_{xy(i,j)_{b2}}&#39;$</span> as described by the  following equation:</p><h6 id="eq:second-invariant-stress*basic*nodes"><a class="docs-heading-anchor" href="#eq:second-invariant-stress*basic*nodes">eq:second-invariant-stress<em>basic</em>nodes</a><a id="eq:second-invariant-stress*basic*nodes-1"></a><a class="docs-heading-anchor-permalink" href="#eq:second-invariant-stress*basic*nodes" title="Permalink"></a></h6><p class="math-container">\[\begin{split}
\sigma_{xx,avg(i,j)_{b2}}&#39; =
    \frac{1}{4}
    \left(
        \sigma_{xx(i,j)_{p2}}&#39; + \sigma_{xx(i+1,j)_{p2}}&#39;
        + \sigma_{xx(i,j+1)_{p2}}&#39; + \sigma_{xx(i+1,j+1)_{p2}}&#39;
    \right) \text{,} \\
\sigma_{II(i,j)_b}&#39; = \sqrt{
    \left(
        \left( \sigma_{xy(i,j)_{b2}}&#39; \right)^2
        + \left( \sigma_{xx,avg(i,j)_{b2}}&#39;\right)^2
    \right)
    }
\end{split}\]</p><p>[2] Compute the second invariant of deviatoric stress for purely elastic stress buildup <span>$\sigma_{II, elastic(i,j)_b}&#39;$</span> using the following equation:</p><h6 id="eq:elastic_stress"><a class="docs-heading-anchor" href="#eq:elastic_stress">eq:elastic_stress</a><a id="eq:elastic_stress-1"></a><a class="docs-heading-anchor-permalink" href="#eq:elastic_stress" title="Permalink"></a></h6><p class="math-container">\[\sigma_{II, elastic(i,j)_b}&#39; = \frac{\mu_{(i,j)_b} \Delta t + \eta_{vp(i,j)_b}}{\eta_{vp(i,j)_b}}
    \sigma_{II(i,j)_b}&#39;\]</p><p>where <span>$\mu_{(i,j)_b}$</span> is the shear modulus at basic nodes and <span>$\Delta t$</span> is the model time step.</p><p>[3] Interpolate pressure from staggered pressure grid <span>$P_{(i,j)_p}$</span> to basic pressure grid  <span>$P_{(i,j)_b}$</span>:</p><h6 id="eq:pressure_basic"><a class="docs-heading-anchor" href="#eq:pressure_basic">eq:pressure_basic</a><a id="eq:pressure_basic-1"></a><a class="docs-heading-anchor-permalink" href="#eq:pressure_basic" title="Permalink"></a></h6><p class="math-container">\[P_{(i,j)_b} = \frac{1}{4}\left(P_{(i,j)_p} + P_{(i+1,j)p} + P_{(i,j+1)p} + P_{(i+1,j+1)p}\right)\]</p><p>[4] Compute the Drucker-Prager yield stress on basic grid <span>$\sigma_{\text{yield}(i,j)_b}$</span> using the following equation:</p><h6 id="eq:yield*stress*basic_nodes"><a class="docs-heading-anchor" href="#eq:yield*stress*basic_nodes">eq:yield<em>stress</em>basic_nodes</a><a id="eq:yield*stress*basic_nodes-1"></a><a class="docs-heading-anchor-permalink" href="#eq:yield*stress*basic_nodes" title="Permalink"></a></h6><p class="math-container">\[\sigma_{yield(i,j)} =
\begin{cases}
    \sigma_{c(i,j)_b} \cos(\theta_{(i,j)_b}) + \sin(\theta_{(i,j)_b})\left(P_{(i,j)_b} - P_f\right) 
        &amp; \quad \text{for} P_{(i,j)_b} \geq P_f\\
    \sigma_{c(i,j)_b} \cos(\theta_{(i,j)_b}) &amp; \quad \text{for} P_{(i,j)_b} &lt; P_f
\end{cases}\]</p><p>where <span>$\sigma_{yield(i,j)}$</span> is the second invariant of the deviatoric stress tensor at basic  grid node at yield, <span>$\sigma_{c(i,j)_b}$</span> is the cohesion, <span>$\theta_{(i,j)_b}$</span> is the friction  angle and <span>$P_f$</span> is the fluid pressure.</p><p>[5] Update visco-plastic viscosity <span>$\eta_{vp(i,j)_b}$</span> for plastic failure using the following equation:</p><h6 id="eq:visco*elasto*plastic*viscosity*update"><a class="docs-heading-anchor" href="#eq:visco*elasto*plastic*viscosity*update">eq:visco<em>elasto</em>plastic<em>viscosity</em>update</a><a id="eq:visco*elasto*plastic*viscosity*update-1"></a><a class="docs-heading-anchor-permalink" href="#eq:visco*elasto*plastic*viscosity*update" title="Permalink"></a></h6><p class="math-container">\[\begin{split}
\eta_{vp(i,j)_b} = 
    \begin{cases}
    \eta_{creep(i,j)_b} 
            &amp; \text{for} \quad \sigma_{II,elastic(i,j)_b}&#39; \leq \sigma_{yield(i,j)_b} \quad \\
    \min \left( \eta_{yield(i,j)_b}
            \text{, } \eta_{creep(i,j)_b} \right)
            &amp; \text{for} \quad \sigma_{II,elastic(i,j)_b}&#39; &gt; \sigma_{yield(i,j)_b}
    \end{cases}
\end{split}\]</p><p>where <span>$\eta_{creep(i,j)_b}$</span> is the composite creep viscosity interpolated from markers and  <span>$\eta_{yield(i,j)_b}$</span> is the visco-plastic viscosity at the yield state as given by:</p><h6 id="eq:yield_viscosity"><a class="docs-heading-anchor" href="#eq:yield_viscosity">eq:yield_viscosity</a><a id="eq:yield_viscosity-1"></a><a class="docs-heading-anchor-permalink" href="#eq:yield_viscosity" title="Permalink"></a></h6><p class="math-container">\[\eta_{yield(i,j)_b} = \mu_{(i,j)_b} \Delta t
        \frac{\sigma_{yield(i,j)_b}}{\sigma_{II,elastic(i,j)_b}&#39; - \sigma_{yield(i,j)_b}}\]</p><p>[6] Update the plastic yielding state on basic nodes <span>$\chi_{(i,j)_b}$</span> using the following      equation:</p><h6 id="eq:plastic_yielding"><a class="docs-heading-anchor" href="#eq:plastic_yielding">eq:plastic_yielding</a><a id="eq:plastic_yielding-1"></a><a class="docs-heading-anchor-permalink" href="#eq:plastic_yielding" title="Permalink"></a></h6><p class="math-container">\[\chi_{(i,j)_b} = 
\begin{cases}
    1 &amp; \text{if } \sigma_{II,elastic(i,j)_b}&#39; &gt; \sigma_{yield(i,j)_b} 
        \text{ and } \eta_{yield(i,j)_b} &lt; \eta_{creep(i,j)_b} \\
    0 &amp; \text{otherwise}
\end{cases}\]</p><p>where a value of 1 indicates that the basic node has undergone plastic failure and a value of 0 indicates that the basic node has not undergone plastic failure.</p><h2 id="Marker-Visco-plastic-Viscosity"><a class="docs-heading-anchor" href="#Marker-Visco-plastic-Viscosity">Marker Visco-plastic Viscosity</a><a id="Marker-Visco-plastic-Viscosity-1"></a><a class="docs-heading-anchor-permalink" href="#Marker-Visco-plastic-Viscosity" title="Permalink"></a></h2><p><strong>For each marker <span>$m$</span> do:</strong></p><p>[1] Determine if plastic yielding has occurred for any basic node associated with the cell that     contains marker <span>$m$</span> using the plastic failure criterion <span>$\chi_{(i,j)_b}$</span> defined on the      basic grid.</p><p>[2] Initialize the visco-plastic viscosity of the marker <span>$\eta_{vp,m}$</span> to the creep viscosity     <span>$\eta_{creep(m)}$</span>.</p><p>[3] If plastic yielding has occurred on a node associated with marker <span>$m$</span> calculate the      visco-plastic viscosity of the marker <span>$\eta_{vp,m}$</span> using a harmonic average limited by the      flow viscosity <span>$\eta_{creep,m}$</span> as follows:</p><h6 id="eq:harmonic*viscosity*average_yield"><a class="docs-heading-anchor" href="#eq:harmonic*viscosity*average_yield">eq:harmonic<em>viscosity</em>average_yield</a><a id="eq:harmonic*viscosity*average_yield-1"></a><a class="docs-heading-anchor-permalink" href="#eq:harmonic*viscosity*average_yield" title="Permalink"></a></h6><p class="math-container">\[\begin{split}
\eta_{yield,m} =
    \left(
        \chi_{(UL)_b}w_{UL,m} + \chi_{(LL)_b}w_{LL,m}
        + \chi_{(UR)_b}w_{UR,m} + \chi_{(LR)_b}w_{LR,m}
    \right)\\
    \left(
    \frac{\chi_{(UL)_b}w_{UL,m}}{\eta_{vp(UL)_b}} +
    \frac{\chi_{(LL)_b}w_{LL,m}}{\eta_{vp(LL)_b}} +
    \frac{\chi_{(UR)_b}w_{UR,m}}{\eta_{vp(UR)_b}} +
    \frac{\chi_{(LR)_b}w_{LR,m}}{\eta_{vp(LR)_b}}
    \right)^{-1} \text{, } \\
\eta_{vp,m} = \min\left(\eta_{yield,m} \text{, } \eta_{creep,m}\right)
\end{split}\]</p><p>where <span>$UL = (i_{ul,m}, j_{ul,m})$</span>, <span>$LL = (i_{ul,m}+1, j_{ul,m})$</span>, <span>$UR = (i_{ul,m}, j_{ul,m}+1)$</span>, and <span>$LR = (i_{ul,m}+1, j_{ul,m}+1)$</span> are the basic nodes indices associated with the cell  containing marker <span>$m$</span> and <span>$w_{UL,m}$</span>, <span>$w_{LL,m}$</span>, <span>$w_{UR,m}$</span>, and <span>$w_{LR,m}$</span> are the  associated node-marker weights calculated using equation eq:node<em>marker</em>weights and <span>$i_{ul,m}$</span> and <span>$j_{ul,m}$</span> are the indices of the upper-left basic grid node of the cell containing marker <span>$m$</span>.</p><h2 id="Subgrid-stress-Diffusion-Steps"><a class="docs-heading-anchor" href="#Subgrid-stress-Diffusion-Steps">Subgrid-stress Diffusion Steps</a><a id="Subgrid-stress-Diffusion-Steps-1"></a><a class="docs-heading-anchor-permalink" href="#Subgrid-stress-Diffusion-Steps" title="Permalink"></a></h2><p>[1] Calculate initial nodal stresses <span>$\sigma_{xx,nodal,m}&#39;$</span> and <span>$\sigma_{xy,nodal,m}&#39;$</span> for each     marker <span>$m$</span> by interpolating <span>$\sigma_{xx(i,j)_{p1}}&#39;$</span> and <span>$\sigma_{xy(i,j)_{b1}}&#39;$</span> to      markers using equation <a href="../../interpolation/marker_grid_interpolation/#eq:bilinear-interp2markers">eq:bilinear-interp2markers</a>.</p><p>[2] Calculated the total subgrid stress differences <span>$\Delta \sigma_{xx,sgt,m}&#39;$</span> and      <span>$\Delta \sigma_{xy,sgt,m}&#39;$</span> for each marker <span>$m$</span> using the following equations:</p><h6 id="eq:subgrid*stress*difference"><a class="docs-heading-anchor" href="#eq:subgrid*stress*difference">eq:subgrid<em>stress</em>difference</a><a id="eq:subgrid*stress*difference-1"></a><a class="docs-heading-anchor-permalink" href="#eq:subgrid*stress*difference" title="Permalink"></a></h6><p class="math-container">\[\begin{split}
\Delta \sigma_{xx,sgt,m}&#39; &amp; = \sigma_{xx,nodal,m}&#39; - \sigma_{xx,m}&#39; \\
\Delta \sigma_{xy,sgt,m}&#39; &amp; = \sigma_{xy,nodal,m}&#39; - \sigma_{xy,m}&#39; \text{.}
\end{split}\]</p><p>[3] Calculate the relaxed subgrid stress differences <span>$\Delta \sigma_{xx,sg,m}&#39;$</span> and      <span>$\Delta \sigma_{xy,sg,m}&#39;$</span> using the following equations:</p><h6 id="eq:subgrid*stress*relaxed"><a class="docs-heading-anchor" href="#eq:subgrid*stress*relaxed">eq:subgrid<em>stress</em>relaxed</a><a id="eq:subgrid*stress*relaxed-1"></a><a class="docs-heading-anchor-permalink" href="#eq:subgrid*stress*relaxed" title="Permalink"></a></h6><p class="math-container">\[\begin{split}
\Delta \sigma_{xx,sg,m}&#39; = \Delta \sigma_{xx,sgt,m}&#39;
    \left(1 - \exp \left({-D_{sg} \frac{\Delta t}{t_{max}}}\right)\right) \\
\Delta \sigma_{xy,sg,m}&#39; = \Delta \sigma_{xy,sgt,m}&#39;
    \left(1 - \exp \left(-D_{sg} \frac{\Delta t}{t_{max}}\right)\right)
\end{split}\]</p><p>where <span>$D_{sg}$</span> is the sub-grid diffusion coefficient and <span>$t_{max}$</span> is the Maxwell time defined as:</p><h6 id="eq:maxwell-time"><a class="docs-heading-anchor" href="#eq:maxwell-time">eq:maxwell-time</a><a id="eq:maxwell-time-1"></a><a class="docs-heading-anchor-permalink" href="#eq:maxwell-time" title="Permalink"></a></h6><p class="math-container">\[t_{max} = \frac{\eta_{vp,m}}{\mu_m} \text{.}\]</p><p>[4] Calculate the relaxed sub-grid stress differences on the staggered grids      <span>$\Delta \sigma_{xx,sg(i,j)_p}&#39;$</span> and <span>$\Delta \sigma_{xy,sg(i,j)_b}&#39;$</span> by interpolating the      relaxed subgrid stress differences from markers <span>$\Delta \sigma_{xx,sg,m}&#39;$</span> and      <span>$\Delta \sigma_{xy,sg,m}&#39;$</span> to the staggered grid using the bilinear interpolation method      described in equation <a href="../../interpolation/marker_grid_interpolation/#eq:bilinear_interp2grid">eq:bilinear_interp2grid</a>.</p><p>[5] Calculate the remaining stress changes on staggered grid nodes by removing the interpolated     relaxed sub-grid stress differences using the following equations:</p><h6 id="eq:remaining*stress*change*on*grid"><a class="docs-heading-anchor" href="#eq:remaining*stress*change*on*grid">eq:remaining<em>stress</em>change<em>on</em>grid</a><a id="eq:remaining*stress*change*on*grid-1"></a><a class="docs-heading-anchor-permalink" href="#eq:remaining*stress*change*on*grid" title="Permalink"></a></h6><p class="math-container">\[\begin{split}
\Delta \sigma_{xx,vepr(i,j)_p}&#39; = 
    \Delta \sigma_{xx(i,j)_p}&#39; - \Delta \sigma_{xx,sg(i,j)_p}&#39; \text{, }\\
\Delta \sigma_{xy,vepr(i,j)_b}&#39; = 
    \Delta \sigma_{xy(i,j)_b}&#39; - \Delta \sigma_{xy,sg(i,j)_b}&#39;
\end{split}\]</p><p>[6] Calculate the remaining visco-elasto plastic stress changes <span>$\Delta \sigma_{xx,vepr,m}&#39;$</span> and <span>$\Delta \sigma_{xy,vepr,m}&#39;$</span> for each marker <span>$m$</span> by  interpolating the remaining stress changes on staggered grid nodes  <span>$\Delta \sigma_{xx,vepr(i,j)_b}&#39;$</span> and <span>$\Delta \sigma_{xy,vepr(i,j)_b}&#39;$</span> to markers using  equation <a href="../../interpolation/marker_grid_interpolation/#eq:bilinear-interp2markers">Eq.</a>.</p><p>[7] Update marker deviatoric stress components <span>$\sigma_{xx,m}&#39;$</span> and <span>$\sigma_{xx,m}&#39;$</span> using     the following equations:</p><h6 id="eq:subgrid*stress*update"><a class="docs-heading-anchor" href="#eq:subgrid*stress*update">eq:subgrid<em>stress</em>update</a><a id="eq:subgrid*stress*update-1"></a><a class="docs-heading-anchor-permalink" href="#eq:subgrid*stress*update" title="Permalink"></a></h6><p class="math-container">\[\begin{split}
\sigma_{xx,m}&#39; = 
    \sigma_{xx,m}&#39;^{o} + \Delta \sigma_{xx,sg,m}&#39; 
    + \Delta \sigma_{xx,vepr,m,}&#39; \text{,}\\
\sigma_{xy,m}&#39; = 
    \sigma_{xy,m}&#39;^{o} + \Delta \sigma_{xy,sg,m}&#39; 
    + \Delta \sigma_{xy,vepr,m}&#39;
\end{split}\]</p><p>where <span>$\sigma_{xx,m}&#39;^{o}$</span> and <span>$\sigma_{xy,m}&#39;^{o}$</span> are the previous marker deviatoric stress components.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../interpolation/marker_grid_interpolation/">芦 Marker-Grid Interpolation</a><a class="docs-footer-nextpage" href="../../heat_algorithm/heat_algorithm/">Heat Algorithm 禄</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.0 on <span class="colophon-date" title="Thursday 20 November 2025 21:32">Thursday 20 November 2025</span>. Using Julia version 1.12.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
